<nav class="navbar navbar-expand-lg navbar-light bg-light" style="padding: 0.25rem 0; min-height: 50px;">
  <div class="container-fluid">
    <a class="navbar-brand" routerLink="/">
      <img src="assets/logo.png" class="logo" alt="Logo" width="80" />
    </a>
    <button
      class="navbar-toggler"
      type="button"
      data-bs-toggle="collapse"
      data-bs-target="#navbarNav"
      aria-controls="navbarNav"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav me-auto">
        <li class="nav-item">
          <a class="nav-link" [routerLink]="'/'" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">Home</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" [routerLink]="'/products-page'" routerLinkActive="active">Produtos</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" [routerLink]="'/artists-page'" routerLinkActive="active">Artistas e Bandas</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" [routerLink]="'/companhias-page'" routerLinkActive="active">Empresas</a>
        </li>
        <!--Se for admin tem uma opcao dashboard-->
        <li *ngIf="user?.user_type === 'admin'" class="nav-item">
          <a class="nav-link" [routerLink]="'/admin-home'" routerLinkActive="active">Dashboard</a>
        </li>
      </ul>



      <!-- Search and Theme Button -->
      <div class="search-login-container ms-auto d-flex">



          <!-- Login Section -->
          <ng-template #loginSection>
            <div class="login-button-container">
              <a class="btn btn-outline-dark"(click)="handleLogin()"><i class="fa fa-user"></i> Login</a>
            </div>
            <form class="d-flex align-items-center" (submit)="onSearch()">
              <input
                class="form-control search-input"
                type="text"
                placeholder="Pesquisar"
                [(ngModel)]="searchQuery"
                name="search"
                (keyup)="onKeyUp()"
              />
              <button class="btn btn-outline-dark search-button" type="submit">
                <i class="fa fa-search"></i>
              </button>
            </form>
          </ng-template>
          <ng-container *ngIf="!user">
            <ng-container *ngTemplateOutlet="loginSection"></ng-container>
          </ng-container>
        </div>
            <!-- User-specific options -->
            <div *ngIf="user" class="ms-auto d-flex align-items-center">
              <div class="navbar-text me-3 fw-bold fs-5">
                Bem-Vindo(a), {{ user.username }}
              </div>
              <form class="d-flex align-items-center me-3" style="margin-right: 10px;" (submit)="onSearch()">
                <input
                  class="form-control search-input"
                  type="text"
                  placeholder="Pesquisar"
                  [(ngModel)]="searchQuery"
                  name="search"
                  (keyup)="onKeyUp()"
                />
                <button class="btn btn-outline-dark search-button" type="submit">
                  <i class="fa fa-search"></i>
                </button>
              </form>
              <ng-container [ngSwitch]="user.user_type">
                <a *ngSwitchCase="'individual'" routerLink="/profile" class="btn btn-outline-dark me-2">
                  <i class="fa fa-user"></i>
                </a>
                <div class="d-flex align-items-center">
                  <!-- Display User Balance -->
                  <span *ngSwitchCase="'individual'" class="btn btn-outline-dark me-2">
                    Saldo: {{ user.balance | currency: 'EUR' }}
                  </span>
                
                  <!-- Add Funds Button -->
                  <button 
                    *ngSwitchCase="'individual'" 
                    class="btn btn-outline-success me-2" 
                    data-bs-toggle="modal" 
                    data-bs-target="#addFundsModal"
                  >
                    <i class="fa fa-plus"></i>
                  </button>
                </div>
                
                <!-- Add Funds Modal -->
                <div 
                  class="modal fade" 
                  id="addFundsModal" 
                  tabindex="-1" 
                  aria-labelledby="addFundsModalLabel" 
                  aria-hidden="true"
                >
                  <div class="modal-dialog">
                    <div class="modal-content">
                      <div class="modal-header">
                        <h5 class="modal-title" id="addFundsModalLabel">Adicionar Saldo</h5>
                        <button 
                          type="button" 
                          class="btn-close" 
                          data-bs-dismiss="modal" 
                          aria-label="Close"
                        ></button>
                      </div>
                      <div class="modal-body">
                        <form>
                          <!-- Payment Method Selection -->
                          <div class="mb-3">
                            <label for="paymentMethod" class="form-label">Método de Pagamento</label>
                            <select 
                              id="paymentMethod" 
                              class="form-select" 
                              [(ngModel)]="selectedPaymentMethod" 
                              name="paymentMethod"
                            >
                              <option value="" disabled selected>Selecione um método</option>
                              <option value="Transferência Bancária">Transferência Bancária</option>
                              <option value="MBWay">MBWay</option>
                              <option value="PayPal">PayPal</option>
                              <option value="Cartão de Crédito">Cartão de Crédito</option>
                              <option value="Criptomoeda">Criptomoeda</option>
                            </select>
                          </div>
                
                          <!-- Amount Input -->
                          <div class="mb-3">
                            <label for="amount" class="form-label">Valor a Adicionar (€)</label>
                            <input 
                              type="number" 
                              id="amount" 
                              class="form-control" 
                              [(ngModel)]="amount" 
                              name="amount" 
                              min="1" 
                              placeholder="Insira o valor"
                            />
                          </div>
                        </form>
                      </div>
                      <div class="modal-footer">
                        <button 
                          type="button" 
                          class="btn btn-secondary" 
                          data-bs-dismiss="modal"
                        >
                          Cancelar
                        </button>
                        <button 
                          type="button" 
                          class="btn btn-success" 
                          [disabled]="!selectedPaymentMethod || !amount || amount <= 0"
                          (click)="addFunds()"
                        >
                          Confirmar
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
                

                <a *ngSwitchCase="'individual'" routerLink="/manage_cart" class="btn btn-outline-dark me-2">
                  <i class="fa fa-shopping-cart"></i>
                </a>
                <a *ngSwitchCase="'individual'" routerLink="/favorites" routerLinkActive="active" class="btn btn-outline-dark me-2">
                  <i class="fa fa-heart text-danger"></i>
                </a>

                <a *ngSwitchCase="'individual'" routerLink="/chat" class="btn btn-outline-dark me-2">
                  <i class="fa fa-message"></i>
                </a>
      
                <a *ngSwitchCase="'admin'" routerLink="/profile" class="btn btn-outline-dark me-2">
                  <i class="fa fa-user"></i>
                </a>

                <a *ngSwitchCase="'admin'" routerLink="/admin/add/company" class="btn btn-outline-dark me-2">
                  <i class="fa fa-plus"></i> Adicionar Empresa
                </a>
      
                <a *ngSwitchCase="'company'" [routerLink]="'/my-company-products/' + user.company?.id" class="btn btn-outline-dark me-2">
                  <i class="bi bi-archive-fill"></i> Ver os meus produtos
                </a>

                <a *ngSwitchCase="'company'" routerLink="/profile" class="btn btn-outline-dark me-2">
                  <i class="fa fa-user"></i>
                </a>

                <a *ngSwitchCase="'company'" routerLink="/chat" class="btn btn-outline-dark me-2">
                  <i class="fa fa-message"></i>
                </a>

                <li class="nav-item dropdown" style="list-style-type: none; margin: 0; padding: 0;">
                  <a
                    class="nav-link dropdown-toggle d-flex align-items-center justify-content-center rounded-circle bg-light"
                    href="#"
                    id="themeDropdown"
                    role="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                    style="
                      width: 50px; 
                      height: 50px; 
                      border: 1px solid #ccc; 
                      padding: 0;
                      margin-right: 10px;"
                  >
                    <i class="fa fa-paint-brush" style="font-size: 20px;"></i>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-end shadow-sm rounded" aria-labelledby="themeDropdown">
                    <li>
                      <a class="dropdown-item d-flex align-items-center" (click)="changeTheme('default')">
                        <i class="fa fa-circle text-primary me-2"></i>
                        <span>Padrão</span>
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item d-flex align-items-center" (click)="changeTheme('christmas')">
                        <i class="fa fa-tree text-success me-2"></i>
                        <span>Natal</span>
                      </a>
                    </li>
                  </ul>
                </li>
                
              </ng-container>

              <a (click)="logout()" class="btn btn-outline-dark"><i class="fas fa-sign-out-alt"></i></a>
            </div>
              
              <app-theme-button></app-theme-button>

      <!-- Display Login Section If User Is Not Logged In -->


    </div>
  </div>
</nav>

<div *ngIf="isLoading" class="loading-overlay">
  <div class="spinner-border text-primary" role="status">
    <span class="visually-hidden">Carregando...</span>
  </div>
</div>
